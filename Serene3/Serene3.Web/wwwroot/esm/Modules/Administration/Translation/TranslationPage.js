import{i as l,o as c}from"../../../_chunks/chunk-L3UZSTF3.js";import"../../../_chunks/chunk-TA7MABRS.js";import{a as v}from"../../../_chunks/chunk-QBFLFHCM.js";import{c as s,f as g,g as p}from"../../../_chunks/chunk-RKUHNEJF.js";var T=g(p(),1);var e=g(p(),1),n=g(v(),1);var d,f,u=class u extends(f=e.EntityGrid,d=Symbol.typeInfo,f){getIdProperty(){return"Key"}getLocalTextPrefix(){return"Administration.Translation"}getService(){return l.baseUrl}constructor(t){super(t),this.element.on("keyup."+this.uniqueName+" change."+this.uniqueName,"input.custom-text",r=>{var i=(0,e.trimToNull)((0,e.Fluent)(r.target).val());i===""&&(i=null),this.view.getItemById((0,e.Fluent)(r.target).data("key")).CustomText=i,this.hasChanges=!0})}onClick(t,r,i){var m;if(super.onClick(t,r,i),t.defaultPrevented||(m=t==null?void 0:t.isDefaultPrevented)!=null&&m.call(t))return;let a=this.itemAt(r),o;if((0,e.Fluent)(t.target).hasClass("source-text")){if(t.preventDefault(),o=s(()=>{a.CustomText=a.SourceText,this.view.updateItem(a.Key,a),this.hasChanges=!0},"done"),(0,e.isTrimmedEmpty)(a.CustomText)||(0,e.trimToEmpty)(a.CustomText)===(0,e.trimToEmpty)(a.SourceText)){o();return}(0,e.confirmDialog)(n.TranslationTexts.OverrideConfirmation,o);return}if((0,e.Fluent)(t.target).hasClass("target-text")){if(t.preventDefault(),o=s(()=>{a.CustomText=a.TargetText,this.view.updateItem(a.Key,a),this.hasChanges=!0},"done"),(0,e.isTrimmedEmpty)(a.CustomText)||(0,e.trimToEmpty)(a.CustomText)===(0,e.trimToEmpty)(a.TargetText)){o();return}(0,e.confirmDialog)(n.TranslationTexts.OverrideConfirmation,o);return}}getColumns(){var t=[];return t.push({field:"Key",name:n.TranslationTexts.Key,width:300,sortable:!1}),t.push({field:"SourceText",name:n.TranslationTexts.SourceText,width:300,sortable:!1,format:s(r=>(0,e.outerHtml)((0,e.Fluent)("a").addClass("source-text").text(r.value||"")),"format")}),t.push({field:"CustomText",name:n.TranslationTexts.CustomText,width:300,sortable:!1,format:s(r=>(0,e.outerHtml)((0,e.Fluent)("input").addClass("custom-text").attr("value",r.value).attr("type","text").attr("placeholder",r.item.TargetText).attr("data-key",r.item.Key)),"format")}),t}createToolbarExtensions(){super.createToolbarExtensions();let t={lookupKey:"Administration.Language"};this.sourceLanguage=e.Widget.create({type:e.LookupEditor,element:s(r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+n.TranslationTexts.SourceLanguage+" ---"),"element"),options:t}),this.sourceLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()}),this.targetLanguage=e.Widget.create({type:e.LookupEditor,element:s(r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+n.TranslationTexts.TargetLanguage+" ---"),"element"),options:t}),this.targetLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()})}saveChanges(t){var r={};for(let i of this.getItems())r[i.Key]=i.CustomText;return Promise.resolve(l.Update({TargetLanguageID:t,Translations:r})).then(()=>{this.hasChanges=!1,t=(0,e.trimToNull)(t)||"invariant",(0,e.notifySuccess)('User translations in "'+t+'" language are saved to "user.texts.'+t+'.json" file under "~/App_Data/texts/"',"")})}onViewSubmit(){var t=this.view.params;return t.SourceLanguageID=this.sourceLanguage.value,this.targetLanguageKey=this.targetLanguage.value||"",t.TargetLanguageID=this.targetLanguageKey,this.hasChanges=!1,super.onViewSubmit()}getButtons(){return[{title:n.TranslationTexts.SaveChangesButton,onClick:s(t=>this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()),"onClick"),cssClass:"apply-changes-button"}]}createQuickSearchInput(){e.GridUtils.addQuickSearchInputCustom(this.toolbar.element,(t,r)=>{this.searchText=r,this.view.setItems(this.view.getItems(),!0)})}onViewFilter(t){if(!super.onViewFilter(t))return!1;if(!this.searchText)return!0;var r=e.stripDiacritics,i=r(this.searchText).toLowerCase();function a(o){return o?o.toLowerCase().indexOf(i)>=0:!1}return s(a,"match"),(0,e.isEmptyOrNull)(i)||a(t.Key)||a(t.SourceText)||a(t.TargetText)||a(t.CustomText)}usePager(){return!1}};s(u,"TranslationGrid"),u[d]=u.registerClass(c);var h=u;var K=s(()=>(0,T.gridPageInit)(h),"default");export{K as default};
//# sourceMappingURL=TranslationPage.js.map
