import{a as E,b as S}from"../../../_chunks/chunk-YOZIQZCU.js";import{g as x,j as b,k as C,l as f,m as r,n as g,o as P}from"../../../_chunks/chunk-L3UZSTF3.js";import{b as D,f as R,g as I,i as U}from"../../../_chunks/chunk-FHHVO6Y3.js";import"../../../_chunks/chunk-TA7MABRS.js";import{c as t,f as c,g as p}from"../../../_chunks/chunk-RKUHNEJF.js";var L=c(p(),1);var w=c(p(),1);var a=c(p(),1);var e=c(p(),1);async function T(d){let o=(await f.List({UserID:d.userID})).Entities,s=(await f.ListRolePermissions({UserID:d.userID})).Entities,n=await(0,e.getRemoteDataAsync)(E.Administration.ImplicitPermissions);var i;new e.Dialog({dialogClass:"s-UserPermissionDialog",title:(0,e.stringFormat)(I.DialogTitle,d.username),buttons:[(0,e.okDialogButton)({click:t(async()=>{await f.Update({UserID:d.userID,Permissions:i.value}),(0,e.notifySuccess)(I.SaveSuccess)},"click")}),(0,e.cancelDialogButton)()],element:t(u=>u.appendChild(U(S,{ref:v=>i=v,showRevoke:!0,value:o,implicitPermissions:n,rolePermissions:s})),"element")})}t(T,"UserPermissionDialog");var k,A,m=class m extends(A=a.EntityDialog,k=Symbol.typeInfo,A){constructor(s){super(s);this.form=new C(this.idPrefix);this.form.Password.change(()=>{a.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value.length<6)return(0,a.stringFormat)(D.MinRequiredPasswordLength,6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return D.PasswordConfirmMismatch})}getFormKey(){return C.formKey}getIdProperty(){return r.idProperty}getIsActiveProperty(){return r.isActiveProperty}getLocalTextPrefix(){return r.localTextPrefix}getNameProperty(){return r.nameProperty}getService(){return g.baseUrl}getToolbarButtons(){let s=super.getToolbarButtons();return s.push({title:R.EditPermissionsButton,cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:t(()=>{T({userID:this.entity.UserId,username:this.entity.Username})},"onClick")}),s}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew())}};t(m,"UserDialog"),m[k]=m.registerClass(P);var y=m;var B,F,l=class l extends(F=w.EntityGrid,B=Symbol.typeInfo,F){getColumnsKey(){return b.columnsKey}getDialogType(){return y}getIdProperty(){return r.idProperty}getIsActiveProperty(){return r.isActiveProperty}getLocalTextPrefix(){return r.localTextPrefix}getService(){return g.baseUrl}constructor(o){super(o)}getDefaultSortBy(){return[r.Fields.Username]}createIncludeDeletedButton(){}getColumns(){var o=super.getColumns(),s=(0,w.tryFirst)(o,i=>i.field==r.Fields.Roles);if(s){var n;x.getLookupAsync().then(i=>{n=i,this.slickGrid.invalidate()}),s.format=i=>{if(!n)return'<i class="fa fa-spinner"></i>';var u=(i.value||[]).map(v=>(n.itemById[v]||{}).RoleName||"");return u.sort(),u.join(", ")}}return o}};t(l,"UserGrid"),l[B]=l.registerClass(P);var h=l;var re=t(()=>(0,L.gridPageInit)(h),"default");export{re as default};
//# sourceMappingURL=UserPage.js.map
