{
  "version": 3,
  "sources": ["../../../../../Modules/Administration/User/UserPage.ts", "../../../../../Modules/Administration/User/UserGrid.ts", "../../../../../Modules/Administration/User/UserDialog.ts", "../../../../../Modules/Administration/UserPermission/UserPermissionDialog.tsx"],
  "sourcesContent": ["import { gridPageInit } from \"@serenity-is/corelib\";\nimport { UserGrid } from \"./UserGrid\";\n\nexport default () => gridPageInit(UserGrid);", "import { EntityGrid, Lookup, tryFirst } from \"@serenity-is/corelib\";\nimport { RoleRow, UserColumns, UserRow, UserService } from \"../../ServerTypes/Administration\";\nimport { nsAdministration } from \"../../ServerTypes/Namespaces\";\nimport { UserDialog } from \"./UserDialog\";\n\nexport class UserGrid extends EntityGrid<UserRow, any> {\n    static [Symbol.typeInfo] = this.registerClass(nsAdministration);\n\n    protected getColumnsKey() { return UserColumns.columnsKey; }\n    protected getDialogType() { return UserDialog; }\n    protected getIdProperty() { return UserRow.idProperty; }\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\n    protected getService() { return UserService.baseUrl; }\n\n    constructor(props: any) {\n        super(props);\n    }\n\n    protected override getDefaultSortBy() {\n        return [UserRow.Fields.Username];\n    }\n\n    protected override createIncludeDeletedButton() {\n    }\n\n    protected override getColumns() {\n        var columns = super.getColumns();\n\n        var roles = tryFirst(columns, x => x.field == UserRow.Fields.Roles);\n        if (roles) {\n            var rolesLookup: Lookup<RoleRow>;\n            RoleRow.getLookupAsync().then(lookup => {\n                rolesLookup = lookup;\n                this.slickGrid.invalidate();\n            });\n\n            roles.format = ctx => {\n                if (!rolesLookup)\n                    return `<i class=\"fa fa-spinner\"></i>`;\n\n                var roleList = (ctx.value || []).map(x => (rolesLookup.itemById[x] || {}).RoleName || \"\");\n                roleList.sort();\n                return roleList.join(\", \");\n            };\n        }\n\n        return columns;\n    }\n}\n", "import { EditorUtils, EntityDialog, stringFormat } from \"@serenity-is/corelib\";\nimport { UserForm, UserRow, UserService } from \"../../ServerTypes/Administration\";\nimport { nsAdministration } from \"../../ServerTypes/Namespaces\";\nimport { MembershipValidationTexts, UserDialogTexts } from \"../../ServerTypes/Texts\";\nimport { UserPermissionDialog } from \"../UserPermission/UserPermissionDialog\";\n\nexport class UserDialog extends EntityDialog<UserRow, any> {\n    static [Symbol.typeInfo] = this.registerClass(nsAdministration);\n\n    protected getFormKey() { return UserForm.formKey; }\n    protected getIdProperty() { return UserRow.idProperty; }\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\n    protected getNameProperty() { return UserRow.nameProperty; }\n    protected getService() { return UserService.baseUrl; }\n\n    protected form = new UserForm(this.idPrefix);\n\n    constructor(props?: any) {\n        super(props);\n\n        this.form.Password.change(() => {\n            EditorUtils.setRequired(this.form.PasswordConfirm, this.form.Password.value.length > 0);\n        });\n\n        this.form.Password.addValidationRule(this.uniqueName, e => {\n            if (this.form.Password.value.length < 6)\n                return stringFormat(MembershipValidationTexts.MinRequiredPasswordLength, 6);\n        });\n\n        this.form.PasswordConfirm.addValidationRule(this.uniqueName, e => {\n            if (this.form.Password.value != this.form.PasswordConfirm.value)\n                return MembershipValidationTexts.PasswordConfirmMismatch;\n        });\n    }\n\n    protected getToolbarButtons() {\n        let buttons = super.getToolbarButtons();\n\n        buttons.push({\n            title: UserDialogTexts.EditPermissionsButton,\n            cssClass: 'edit-permissions-button',\n            icon: 'fa-lock text-green',\n            onClick: () => {\n                UserPermissionDialog({\n                    userID: this.entity.UserId,\n                    username: this.entity.Username\n                });\n            }\n        });\n\n        return buttons;\n    }\n\n    protected updateInterface() {\n        super.updateInterface();\n\n        this.toolbar.findButton(\"edit-permissions-button\").toggleClass(\"disabled\", this.isNewOrDeleted());\n    }\n\n    protected afterLoadEntity() {\n        super.afterLoadEntity();\n\n        // these fields are only required in new record mode\n        this.form.Password.element.toggleClass('required', this.isNew())\n            .closest('.field').findFirst('sup').toggle(this.isNew());\n        this.form.PasswordConfirm.element.toggleClass('required', this.isNew())\n            .closest('.field').findFirst('sup').toggle(this.isNew());\n    }\n}\n", "import { Dialog, cancelDialogButton, getRemoteDataAsync, notifySuccess, okDialogButton, stringFormat } from \"@serenity-is/corelib\";\nimport { UserPermissionService } from \"../../ServerTypes/Administration\";\nimport { RemoteDataKeys } from \"../../ServerTypes/RemoteDataKeys\";\nimport { UserPermissionDialogTexts } from \"../../ServerTypes/Texts\";\nimport { PermissionCheckEditor } from \"../UserPermission/PermissionCheckEditor\";\n\nexport async function UserPermissionDialog(props: { userID: number, username: string }) {\n\n    const permissions = (await UserPermissionService.List({ UserID: props.userID })).Entities;\n    const rolePermissions = (await UserPermissionService.ListRolePermissions({ UserID: props.userID })).Entities;\n\n    let implicitPermissions = await getRemoteDataAsync<Record<string, string[]>>(RemoteDataKeys.Administration.ImplicitPermissions);\n\n    var checkEditor: PermissionCheckEditor;\n    new Dialog({\n        dialogClass: \"s-UserPermissionDialog\",\n        title: stringFormat(UserPermissionDialogTexts.DialogTitle, props.username),\n        buttons: [\n            okDialogButton({\n                click: async () => {\n                    await UserPermissionService.Update({\n                        UserID: props.userID,\n                        Permissions: checkEditor.value\n                    });\n                    notifySuccess(UserPermissionDialogTexts.SaveSuccess);\n                }\n            }),\n            cancelDialogButton()\n        ],\n        element: el => el.appendChild(<PermissionCheckEditor ref={w => checkEditor = w}\n            showRevoke={true} value={permissions} implicitPermissions={implicitPermissions} rolePermissions={rolePermissions} />)\n    });\n}\n\n"],
  "mappings": "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",
  "names": ["import_corelib", "import_corelib", "import_corelib", "import_corelib", "UserPermissionDialog", "props", "permissions", "UserPermissionService", "rolePermissions", "implicitPermissions", "RemoteDataKeys", "checkEditor", "UserPermissionDialogTexts", "__name", "el", "jsx", "PermissionCheckEditor", "w", "_a", "_b", "_UserDialog", "props", "UserForm", "e", "MembershipValidationTexts", "UserRow", "UserService", "buttons", "UserDialogTexts", "__name", "UserPermissionDialog", "nsAdministration", "UserDialog", "_a", "_b", "_UserGrid", "UserColumns", "UserDialog", "UserRow", "UserService", "props", "columns", "roles", "x", "rolesLookup", "RoleRow", "lookup", "ctx", "roleList", "__name", "nsAdministration", "UserGrid", "UserPage_default", "__name", "UserGrid"]
}
